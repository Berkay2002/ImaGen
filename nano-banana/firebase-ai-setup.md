# Firebase AI Logic SDK Setup Guide (Flutter/Dart)

## Prerequisites

### Development Environment
- **Flutter SDK**: 3.0.0 or higher
- **Dart SDK**: Included with Flutter
- **IDE**: VS Code, Android Studio, or IntelliJ IDEA

### Firebase Project Setup

1. **Create a Firebase Project**
   - Go to [Firebase Console](https://console.firebase.google.com/)
   - Click "Add project" or select existing project
   
2. **Configure Firebase AI Logic**
   - Navigate to Firebase AI Logic page in console
   - Click "Get started"
   - Select **Gemini Developer API** (recommended for first-time users)
     - Available on free Spark plan
     - Can upgrade later if needed
     - Console creates Gemini API key automatically
     - **Important**: Do NOT add API key to your app's codebase
   
   OR select **Vertex AI Gemini API**
   - Requires pay-as-you-go Blaze pricing plan
   - Console helps set up billing and enable required APIs

3. **Register Your App**
   - Follow console workflow to register Flutter app
   - Download `google-services.json` (Android) or `GoogleService-Info.plist` (iOS)

## Installation

### 1. Add Dependencies

```yaml
# pubspec.yaml
dependencies:
  flutter:
    sdk: flutter
  firebase_core: ^4.2.1
  firebase_ai: ^3.6.0
```

Run:
```bash
flutter pub get
```

### 2. Configure Android

Add to `android/build.gradle`:
```gradle
buildscript {
  dependencies {
    classpath 'com.google.gms:google-services:4.4.2'
  }
}
```

Add to `android/app/build.gradle`:
```gradle
apply plugin: 'com.google.gms.google-services'
```

Place `google-services.json` in `android/app/`

### 3. Configure iOS

Place `GoogleService-Info.plist` in `ios/Runner/`

Update `ios/Runner/Info.plist` if needed for capabilities.

### 4. Initialize Firebase

```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // Generated by FlutterFire CLI

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  
  runApp(MyApp());
}
```

## Basic Usage

### Initialize Gemini Model (Gemini Developer API)

```dart
import 'package:firebase_ai/firebase_ai.dart';

// Initialize the service
final ai = FirebaseAI.firebaseAI(backend: .googleAI());

// Create a model instance
final model = ai.generativeModel(
  modelName: 'gemini-2.5-flash',
);
```

### Generate Text from Text Prompt

```dart
final prompt = "Write a story about a magic backpack.";

try {
  final response = await model.generateContent([
    Content.text(prompt)
  ]);
  
  print(response.text ?? "No response");
} catch (e) {
  print('Error: $e');
}
```

### Generate Text from Image

```dart
import 'dart:io';

final imageFile = File('path/to/image.jpg');
final imageBytes = await imageFile.readAsBytes();

final response = await model.generateContent([
  Content.multi([
    InlineDataPart('image/jpeg', imageBytes),
    TextPart('What is in this image?'),
  ])
]);

print(response.text);
```

### Generate Images with Gemini 2.5 Flash Image

```dart
final imageModel = ai.generativeModel(
  modelName: 'gemini-2.5-flash-image',
  generationConfig: GenerationConfig(
    responseModalities: [ResponseModalities.text, ResponseModalities.image],
  ),
);

final prompt = "Generate an image of the Eiffel tower with fireworks";

final response = await imageModel.generateContent([
  Content.text(prompt)
]);

// Extract generated images
for (final part in response.candidates.first.content.parts) {
  if (part is InlineDataPart) {
    final imageBytes = part.bytes;
    // Save or display image
    await File('output.png').writeAsBytes(imageBytes);
  }
}
```

## Available Models

### Text Generation
- **gemini-2.5-flash** - Fast, efficient, recommended for most use cases
- **gemini-2.5-flash-lite** - Lighter version, lower cost
- **gemini-2.5-pro** - More capable, higher quality (Preview)

### Image Generation
- **gemini-2.5-flash-image** (aka "nano banana") - Text/image to image
  - Requires Blaze plan regardless of API provider
  - Always returns text + images
  - Must set `responseModalities: [text, image]`

## Important Notes

### API Keys
- **Do NOT** add Gemini API keys to your app code
- Firebase AI Logic SDK manages authentication automatically
- API key is stored securely in Firebase project

### Pricing
- **Gemini Developer API**: Free tier available, optional billing
- **Vertex AI Gemini API**: Requires Blaze plan (pay-as-you-go)
- **Image generation models**: Always require Blaze plan

### App Check (Recommended)
Set up [Firebase App Check](https://firebase.google.com/docs/app-check) to:
- Protect against API abuse
- Prevent unauthorized access
- Required for production apps

## Model Configuration

### Generation Config

```dart
final model = ai.generativeModel(
  modelName: 'gemini-2.5-flash',
  generationConfig: GenerationConfig(
    temperature: 0.7,          // 0.0-2.0, controls randomness
    topP: 0.95,               // Nucleus sampling
    topK: 40,                 // Top-k sampling
    maxOutputTokens: 2048,    // Max response length
  ),
);
```

### Safety Settings

```dart
final model = ai.generativeModel(
  modelName: 'gemini-2.5-flash',
  safetySettings: [
    SafetySetting(
      category: HarmCategory.harassment,
      threshold: HarmBlockThreshold.blockMediumAndAbove,
    ),
  ],
);
```

### System Instructions

```dart
final model = ai.generativeModel(
  modelName: 'gemini-2.5-flash',
  systemInstruction: Content.text(
    'You are a helpful assistant that provides concise answers.'
  ),
);
```

## Error Handling

```dart
try {
  final response = await model.generateContent([
    Content.text(prompt)
  ]);
  
  if (response.text != null && response.text!.isNotEmpty) {
    print('Success: ${response.text}');
  } else {
    print('Empty response');
  }
} on GenerativeAIException catch (e) {
  print('AI Error: ${e.message}');
} catch (e) {
  print('General Error: $e');
}
```

## Streaming Responses

```dart
final stream = model.generateContentStream([
  Content.text('Explain quantum computing')
]);

await for (final chunk in stream) {
  print(chunk.text ?? '');
}
```

## Multi-turn Chat

```dart
final chat = model.startChat();

var response = await chat.sendMessage([
  Content.text('Hello, how are you?')
]);
print(response.text);

response = await chat.sendMessage([
  Content.text('What did I just say?')
]);
print(response.text);
```

## Testing & Development

### Google AI Studio
Use [Google AI Studio](https://aistudio.google.com/) to:
- Test prompts interactively
- Experiment with model parameters
- Generate code snippets
- No coding required

### Remote Config
Use [Firebase Remote Config](https://firebase.google.com/docs/ai-logic/solutions/remote-config) to:
- Change model names without app updates
- A/B test different prompts
- Roll out changes gradually

## Next Steps

- [Generate & Edit Images Guide](./image-generation.md)
- [Analyze Images Guide](./image-understanding.md)
- [Official Firebase AI Logic Docs](https://firebase.google.com/docs/ai-logic)
- [Flutter Samples](https://github.com/firebase/quickstart-flutter)

## Common Issues

### "API not enabled"
- Ensure required APIs are enabled in Google Cloud Console
- Wait a few minutes after enabling

### "Invalid API key"
- Don't add API keys to code - SDK handles authentication
- Verify Firebase project setup in console

### "Quota exceeded"
- Check [rate limits](https://firebase.google.com/docs/ai-logic/quotas)
- Upgrade to Blaze plan for higher limits
- Implement exponential backoff for retries

### "Request too large"
- Max 20 MB total request size
- Resize images before uploading
- Use File API for large files
